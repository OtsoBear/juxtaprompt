var e=Object.defineProperty,t=(t,o,r)=>(((t,o,r)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r})(t,"symbol"!=typeof o?o+"":o,r),r);import{v as o,a as r}from"./llm-services-bfcb06ee.js";const s={gridColumns:2,autoSend:!1,debounceMs:500,showAdvancedSettings:!1,theme:"system"},n=2e3,a="state";const i=new class{constructor(){t(this,"inMemoryKeys",new Map),t(this,"PREFERENCE_KEY","juxtaprompt_storage_preference"),t(this,"API_KEY_PREFIX","juxtaprompt_api_key_")}getStoragePreference(){const e=localStorage.getItem(this.PREFERENCE_KEY);if(e)try{const t=JSON.parse(e),r=o(t);if(r.success)return r.data}catch(t){}return{type:"session",acknowledgedRisks:!1}}setStoragePreference(e){const t=o(e);if(!t.success)throw new Error(`Invalid storage preference: ${t.error.message}`);localStorage.setItem(this.PREFERENCE_KEY,JSON.stringify(e)),"none"===e.type?(this.clearSessionStorage(),this.clearLocalStorage()):"session"===e.type&&this.clearLocalStorage()}saveAPIKey(e,t){if(!t||0===t.trim().length)throw new Error("API key cannot be empty");const o=this.getStoragePreference(),r=this.getStorageKey(e);switch(this.clearAPIKeyFromAllStorageTypes(e),o.type){case"none":this.inMemoryKeys.set(r,t);break;case"session":try{sessionStorage.setItem(r,t)}catch(s){this.inMemoryKeys.set(r,t)}break;case"local":if(!o.acknowledgedRisks)throw new Error("Cannot use local storage without acknowledging security risks");try{localStorage.setItem(r,t)}catch(s){try{sessionStorage.setItem(r,t)}catch(n){this.inMemoryKeys.set(r,t)}}break;default:throw new Error(`Unknown storage type: ${o.type}`)}}getAPIKey(e){const t=this.getStoragePreference(),o=this.getStorageKey(e);switch(t.type){case"none":return this.inMemoryKeys.get(o)??null;case"session":try{return sessionStorage.getItem(o)}catch(r){return this.inMemoryKeys.get(o)??null}case"local":try{return localStorage.getItem(o)}catch(r){try{return sessionStorage.getItem(o)}catch(s){return this.inMemoryKeys.get(o)??null}}default:return null}}clearAPIKey(e){this.clearAPIKeyFromAllStorageTypes(e)}clearAllAPIKeys(){this.inMemoryKeys.clear(),this.clearSessionStorage(),this.clearLocalStorage()}getStoredProviders(){const e=[],t=["openai","anthropic","gemini"];for(const o of t)this.getAPIKey(o)&&e.push(o);return e}hasStoredKeys(){return this.getStoredProviders().length>0}getStorageStats(){return{memoryKeys:this.inMemoryKeys.size,sessionKeys:this.countKeysInStorage(sessionStorage),localKeys:this.countKeysInStorage(localStorage)-1,preference:this.getStoragePreference()}}getStorageKey(e){return`${this.API_KEY_PREFIX}${e}`}clearAPIKeyFromAllStorageTypes(e){const t=this.getStorageKey(e);this.inMemoryKeys.delete(t);try{sessionStorage.removeItem(t)}catch(o){}try{localStorage.removeItem(t)}catch(o){}}clearSessionStorage(){try{const e=[];for(let t=0;t<sessionStorage.length;t++){const o=sessionStorage.key(t);(null==o?void 0:o.startsWith(this.API_KEY_PREFIX))&&e.push(o)}e.forEach(e=>sessionStorage.removeItem(e))}catch(e){}}clearLocalStorage(){try{const e=[];for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);(null==o?void 0:o.startsWith(this.API_KEY_PREFIX))&&e.push(o)}e.forEach(e=>localStorage.removeItem(e))}catch(e){}}countKeysInStorage(e){try{let t=0;for(let o=0;o<e.length;o++){const r=e.key(o);(null==r?void 0:r.startsWith(this.API_KEY_PREFIX))&&t++}return t}catch(t){return 0}}};const c=new class{constructor(){t(this,"maxURLLength",n),t(this,"parameterName",a)}saveStateToURL(e){try{const t=this.compressState(e),o=new URLSearchParams(window.location.search);o.set(this.parameterName,t);const r=`${window.location.pathname}?${o.toString()}`;r.length<=this.maxURLLength&&window.history.replaceState({},"",r)}catch(t){}}loadStateFromURL(){try{const e=new URLSearchParams(window.location.search).get(this.parameterName);if(!e)return null;const t=this.decompressState(e);return this.validateState(t)}catch(e){return null}}clearURLState(){try{const e=new URLSearchParams(window.location.search);e.delete(this.parameterName);const t=e.toString()?`${window.location.pathname}?${e.toString()}`:window.location.pathname;window.history.replaceState({},"",t)}catch(e){}}getShareableURL(e){try{const t=this.compressState(e),o=new URL(window.location.href);o.searchParams.set(this.parameterName,t);const r=o.toString();if(r.length>this.maxURLLength)throw new Error(`Shareable URL too long (${r.length} chars)`);return r}catch(t){return window.location.href}}compressState(e){try{const t=this.createMinimalState(e),o=JSON.stringify(t),r=encodeURIComponent(o);return btoa(r)}catch(t){throw new Error("State compression failed")}}decompressState(e){try{const t=atob(e),o=decodeURIComponent(t),r=JSON.parse(o);return this.mergeWithDefaults(r)}catch(t){throw new Error("State decompression failed")}}validateState(e){try{const t=r(e);return t.success?t.data:null}catch(t){return null}}createMinimalState(e){const t={};if(e.prompts.length>0){const o=e.prompts.filter(e=>e.trim().length>0);o.length>0&&(t.prompts=o)}const o={};e.config.provider&&(o.provider=e.config.provider),e.config.model&&(o.model=e.config.model),void 0!==e.config.temperature&&.7!==e.config.temperature&&(o.temperature=e.config.temperature),void 0!==e.config.maxTokens&&2048!==e.config.maxTokens&&(o.maxTokens=e.config.maxTokens),void 0!==e.config.topP&&1!==e.config.topP&&(o.topP=e.config.topP),void 0!==e.config.frequencyPenalty&&0!==e.config.frequencyPenalty&&(o.frequencyPenalty=e.config.frequencyPenalty),void 0!==e.config.presencePenalty&&0!==e.config.presencePenalty&&(o.presencePenalty=e.config.presencePenalty),e.config.systemMessage&&(o.systemMessage=e.config.systemMessage),Object.keys(o).length>0&&(t.config=o);const r={};return void 0!==e.ui.gridColumns&&2!==e.ui.gridColumns&&(r.gridColumns=e.ui.gridColumns),void 0!==e.ui.autoSend&&!1!==e.ui.autoSend&&(r.autoSend=e.ui.autoSend),void 0!==e.ui.debounceMs&&500!==e.ui.debounceMs&&(r.debounceMs=e.ui.debounceMs),void 0!==e.ui.showAdvancedSettings&&!1!==e.ui.showAdvancedSettings&&(r.showAdvancedSettings=e.ui.showAdvancedSettings),void 0!==e.ui.theme&&"system"!==e.ui.theme&&(r.theme=e.ui.theme),Object.keys(r).length>0&&(t.ui=r),t}mergeWithDefaults(e){var t,o,r,s,n,a,i,c,l,g,h,u,m;return{prompts:e.prompts||[],config:{...(null==(t=e.config)?void 0:t.provider)&&{provider:e.config.provider},...(null==(o=e.config)?void 0:o.model)&&{model:e.config.model},...void 0!==(null==(r=e.config)?void 0:r.temperature)&&{temperature:e.config.temperature},...void 0!==(null==(s=e.config)?void 0:s.maxTokens)&&{maxTokens:e.config.maxTokens},...void 0!==(null==(n=e.config)?void 0:n.topP)&&{topP:e.config.topP},...void 0!==(null==(a=e.config)?void 0:a.frequencyPenalty)&&{frequencyPenalty:e.config.frequencyPenalty},...void 0!==(null==(i=e.config)?void 0:i.presencePenalty)&&{presencePenalty:e.config.presencePenalty},...(null==(c=e.config)?void 0:c.systemMessage)&&{systemMessage:e.config.systemMessage}},ui:{...void 0!==(null==(l=e.ui)?void 0:l.gridColumns)&&{gridColumns:e.ui.gridColumns},...void 0!==(null==(g=e.ui)?void 0:g.autoSend)&&{autoSend:e.ui.autoSend},...void 0!==(null==(h=e.ui)?void 0:h.debounceMs)&&{debounceMs:e.ui.debounceMs},...void 0!==(null==(u=e.ui)?void 0:u.showAdvancedSettings)&&{showAdvancedSettings:e.ui.showAdvancedSettings},...(null==(m=e.ui)?void 0:m.theme)&&{theme:e.ui.theme}}}}hasURLState(){return new URLSearchParams(window.location.search).has(this.parameterName)}getStateSize(){const e=new URLSearchParams(window.location.search).get(this.parameterName);return e?new Blob([e]).size:0}estimateStateSize(e){try{const t=this.compressState(e);return new Blob([t]).size}catch{return 0}}canFitInURL(e){try{return this.getShareableURL(e).length<=this.maxURLLength}catch{return!1}}};export{s as D,i as s,c as u};
//# sourceMappingURL=services-f69c01bc.js.map
